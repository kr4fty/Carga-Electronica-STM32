#include <Arduino.h>
#include <Adafruit_PCD8544.h>
#include <RotaryEncoder.h>

//#define LED LED_BUILTIN

#define ENCODER_PIN_A   PA0
#define ENCODER_PIN_B   PA1
#define BUTTON_PIN      PA2

Adafruit_PCD8544 lcd = Adafruit_PCD8544(LCD_SCLK_PIN, LCD_DIN_PIN, LCD_DC_PIN, LCD_CS_PIN, LCD_RST_PIN);

int16_t position = 0;
RotaryEncoder encoder(ENCODER_PIN_A, ENCODER_PIN_B, BUTTON_PIN);
void encoderISR(){
  encoder.readAB();
}

void encoderButtonISR(){
  encoder.readPushButton();
}

void setup() {
  //pinMode(LED, OUTPUT);
  lcd.begin();
  lcd.setContrast(75);
  lcd.clearDisplay();
  lcd.setTextColor(BLACK, WHITE);
  lcd.setTextSize(2);
  lcd.setCursor(LCDWIDTH/2-24, 0);
  lcd.print("HOLA");
  lcd.display();
  lcd.setTextSize(1);

  encoder.begin();                                                           //set encoders pins as input & enable built-in pullup resistors

  attachInterrupt(digitalPinToInterrupt(ENCODER_PIN_A), encoderISR, CHANGE);  //call encoderISR()    every high->low or low->high changes
  attachInterrupt(digitalPinToInterrupt(BUTTON_PIN), encoderButtonISR, FALLING); //call pushButtonISR() every high->low              changes
  encoder.setPosition(-1);

}


void loop() {
  if (position != encoder.getPosition())
  {
    position = encoder.getPosition();
    lcd.setCursor(LCDWIDTH/2-4, LCDHEIGHT/2-4);
    lcd.print("   ");
    lcd.setCursor(LCDWIDTH/2-4, LCDHEIGHT/2-4);
    lcd.print(position);
    lcd.display();
  }

  if (encoder.getPushButton() == true){
    lcd.setCursor(LCDWIDTH/2-16, LCDHEIGHT-8);
    lcd.print("PRESSED");
    lcd.display();
  }
  else{
    lcd.setCursor(LCDWIDTH/2-16, LCDHEIGHT-8);
    lcd.print("       ");
    lcd.display();
  }

  delay(100);

  /*digitalWrite(LED,HIGH);
  delay(1000);
  digitalWrite(LED,LOW);
  delay(1000);*/
}